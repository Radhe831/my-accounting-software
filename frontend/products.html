<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
</head>
<body>
    <h1>Product List</h1>
    <ul id="productList"></ul>
    <a href="/create_item.html">Add New Product</a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productList = document.getElementById('productList');

            async function fetchProducts() {
                try {
                    const response = await fetch('/api/items');
                    const items = await response.json();
                    productList.innerHTML = '';
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${item.name}</strong> - Price: ${item.pricing.sale.price}`;
                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Delete';
                        deleteButton.style.marginLeft = '10px';
                        deleteButton.onclick = () => deleteItem(item._id, item.name);
                        li.appendChild(deleteButton);
                        productList.appendChild(li);
                    });
                } catch (error) {
                    console.error('Error fetching products:', error);
                }
            }

            async function deleteItem(itemId, itemName) {
                if (!confirm(`Are you sure you want to delete "${itemName}"?`)) {
                    return;
                }
                try {
                    const response = await fetch(`/api/items/${itemId}`, { method: 'DELETE' });
                    if (response.ok) {
                        alert('Item deleted successfully!');
                        fetchProducts();
                    } else {
                        alert('Failed to delete item.');
                    }
                } catch (error) {
                    console.error('Error deleting item:', error);
                }
            }
            fetchProducts();
        });
    </script>
</body>
</html>